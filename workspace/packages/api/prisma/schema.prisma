generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Contractor {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  verifications Verification[]
  credentials   Credential[]
  auditLogs     AuditLog[]
}

model Verification {
  id           String   @id @default(uuid())
  contractorId String
  contractor   Contractor @relation(fields: [contractorId], references: [id])

  type         String   // "identity", "github", "linkedin", "background_check", "reference"
  status       String   // "pending", "verified", "failed"
  provider     String?  // "persona", "checkr", etc.

  data         String   // Verification-specific data (JSON stringified)

  initiatedAt  DateTime @default(now())
  completedAt  DateTime?
  expiresAt    DateTime?

  @@index([contractorId, type])
  @@index([status])
}

model Credential {
  id           String   @id @default(uuid())
  contractorId String
  contractor   Contractor @relation(fields: [contractorId], references: [id])

  tier         String   // "PROVISIONAL", "FULL_CLEARANCE"
  jwtToken     String

  issuedAt     DateTime @default(now())
  expiresAt    DateTime
  revokedAt    DateTime?

  @@index([contractorId])
  @@index([tier])
}

model AuditLog {
  id           String   @id @default(uuid())
  contractorId String?
  contractor   Contractor? @relation(fields: [contractorId], references: [id])

  action       String   // "verification_started", "credential_issued", "credential_viewed", etc.
  actor        String   // "system", "contractor:uuid", "employer:uuid"
  metadata     String   // JSON stringified

  timestamp    DateTime @default(now())

  @@index([contractorId])
  @@index([action])
  @@index([timestamp])
}
